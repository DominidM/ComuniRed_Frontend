<div class="modal" *ngIf="isOpen" (click)="cerrarDesdeFondo($event)">
  <div class="modal-contenido" (click)="$event.stopPropagation()">

    <!-- BotÃ³n cerrar -->
    <button class="btn-cerrar-x" (click)="cerrarModal()">âœ–</button>

    <!-- TÃ­tulo del modal -->
    <h3 class="modal-titulo">Detalles del Reporte</h3>

    <!-- ImÃ¡genes -->
    <div class="imagenes" *ngIf="reporte.imagenes.length">
      <img *ngFor="let img of reporte.imagenes"
           [src]="img"
           alt="imagen mini"
           class="imagen-mini">
    </div>

    <!-- TÃ­tulo del reporte -->
    <h2 class="reporte-titulo">{{ reporte.titulo }}</h2>

    <!-- DescripciÃ³n -->
    <div class="seccion">
      <h4><i class="bi bi-chat-left-dots-fill"></i> DescripciÃ³n</h4>
      <p>{{ reporte.descripcion }}</p>
    </div>

    <!-- InformaciÃ³n del cliente -->
    <div class="seccion">
      <h4><i class="bi bi-person-fill"></i> InformaciÃ³n del Cliente</h4>
      <p><strong>Nombre:</strong> {{ reporte.cliente.nombre }}</p>
      <p *ngIf="reporte?.cliente?.telefono"><strong>TelÃ©fono:</strong> {{ reporte.cliente.telefono }}</p>
      <p *ngIf="reporte?.cliente?.email"><strong>Email:</strong> {{ reporte.cliente.email }}</p>
      <p *ngIf="reporte?.cliente?.direccion"><strong>DirecciÃ³n:</strong> {{ reporte.cliente.direccion }}</p>
    </div>

    <!-- UbicaciÃ³n -->
    <div class="seccion">
      <h4><i class="bi bi-geo-alt-fill"></i> UbicaciÃ³n</h4>
      <p>Direccion: {{ reporte.ubicacion }}</p>
      <p *ngIf="reporte.lat && reporte.lng"> Coordenadas: {{ reporte.lat }}, {{ reporte.lng }} </p>
    </div>

    <div class="seccion">
      <h4><i class="bi bi-person-fill"></i> InformaciÃ³n del Soporte</h4>
      <p class="responsable">Responsable: {{ reporte.soporte.nombre }}</p>
      <p class="fecha-estimada" *ngIf="ultimoHistorial">
        Fecha estimada de resoluciÃ³n: {{ ultimoHistorial.fecha | date:'dd/MM/yyyy, h:mm a' }}
      </p>
    </div>


    <!-- Reacciones -->
    <div class="seccion">
      <h4>Reacciones</h4>
      <p class="reacciones">
        <span>ğŸ‘ {{ reporte.reacciones.likes }}</span>
        <span>ğŸ‘ {{ reporte.reacciones.dislikes }}</span>
        <span>â¤ï¸ {{ reporte.reacciones.love }}</span>
        <span>ğŸ˜® {{ reporte.reacciones.wow }}</span>
        <span>ğŸ˜” {{ reporte.reacciones.sad }}</span>
        <span>âš ï¸ {{ reporte.reacciones.reportes }}</span>
        <span>â˜‘ï¸ {{ reporte.reacciones.helpful }}</span>
      </p>
    </div>

    <!-- Progreso de estados -->
    <div class="seccion progreso">
      <div class="estado" [class.activo]="getUltimoEstado() === 'enviado'">Pendiente</div>
      <div class="estado" [class.activo]="getUltimoEstado() === 'observado'">En Proceso</div>
      <div class="estado" [class.activo]="getUltimoEstado() === 'en progreso'">Resuelto</div>
      <div class="estado" [class.activo]="getUltimoEstado() === 'resuelto'">Cerrado</div>
    </div>

    <!-- Historial -->
    <div class="seccion historial" *ngIf="reporte?.historial?.length">
      <h4><i class="bi bi-clock-history"></i> Historial</h4>
      <ul>
        <li *ngFor="let h of reporte.historial">
          {{ h.mensaje }} - <small>{{ h.fecha | date:'short' }}</small>
          (<em>{{ h.estado }}</em>)
        </li>
      </ul>
    </div>

    <!-- Footer botones -->
    <div class="modal-footer">
      <button class="btn-avanzar" (click)="avanzarProgreso()">Avanzar Progreso</button>
      <button class="btn-cerrar" (click)="cerrarModal()">Cerrar</button>
    </div>

  </div>
</div>
