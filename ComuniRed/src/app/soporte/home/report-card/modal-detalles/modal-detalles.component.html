<div class="modal" *ngIf="isOpen" (click)="cerrarDesdeFondo($event)">
  <div class="modal-contenido" (click)="$event.stopPropagation()">

    <button class="btn-cerrar-x" (click)="cerrarModal()">âœ–</button>

    <h3 class="modal-titulo">Detalles del Reporte</h3>

    <div class="imagenes" *ngIf="reporte.imagenes.length">
      <img *ngFor="let img of reporte.imagenes"
           [src]="img"
           alt="imagen mini"
           class="imagen-mini">
    </div>

    <h2 class="reporte-titulo">{{ reporte.titulo }}</h2>

    <div class="seccion">
      <h4><i class="bi bi-chat-left-dots-fill"></i> DescripciÃ³n</h4>
      <p>{{ reporte.descripcion }}</p>
    </div>

    <div class="seccion">
      <h4><i class="bi bi-person-fill"></i> InformaciÃ³n del Cliente</h4>
      <p><strong>Nombre:</strong> {{ reporte.cliente.nombre }}</p>
      <p *ngIf="reporte?.cliente?.telefono"><strong>TelÃ©fono:</strong> {{ reporte.cliente.telefono }}</p>
      <p *ngIf="reporte?.cliente?.email"><strong>Email:</strong> {{ reporte.cliente.email }}</p>
      <p *ngIf="reporte?.cliente?.direccion"><strong>DirecciÃ³n:</strong> {{ reporte.cliente.direccion }}</p>
    </div>

    <div class="seccion">
      <h4><i class="bi bi-geo-alt-fill"></i> UbicaciÃ³n</h4>
      <p>Direccion: {{ reporte.ubicacion }}</p>
      <p *ngIf="reporte.lat && reporte.lng"> Coordenadas: {{ reporte.lat }}, {{ reporte.lng }} </p>
    </div>

    <div class="seccion">
      <h4><i class="bi bi-person-fill"></i> InformaciÃ³n del Soporte</h4>
      <p class="responsable">Responsable: {{ reporte.soporte.nombre }}</p>
      <p class="fecha-estimada" *ngIf="ultimoHistorial">
        Fecha estimada de resoluciÃ³n: {{ ultimoHistorial.fecha | date:'dd/MM/yyyy, h:mm a' }}
      </p>
    </div>

    <div class="seccion">
      <h4>Reacciones</h4>
      <p class="reacciones">
        <span>ğŸ‘ {{ reporte.reacciones.likes }}</span>
        <span>ğŸ‘ {{ reporte.reacciones.dislikes }}</span>
        <span>â¤ï¸ {{ reporte.reacciones.love }}</span>
        <span>ğŸ˜® {{ reporte.reacciones.wow }}</span>
        <span>ğŸ˜” {{ reporte.reacciones.sad }}</span>
        <span>âš ï¸ {{ reporte.reacciones.reportes }}</span>
        <span>â˜‘ï¸ {{ reporte.reacciones.helpful }}</span>
      </p>
    </div>

    <div class="seccion selector-estado">
      <label>Estado del Reporte:</label>
      <select [(ngModel)]="ultimoEstadoModal" (ngModelChange)="cambiarEstado($event)">
        <option value="enviado">Pendiente</option>
        <option value="observado">En Proceso</option>
        <option value="en progreso">Resuelto</option>
        <option value="resuelto">Cerrado</option>
      </select>
    </div>


    <div class="seccion historial" *ngIf="reporte?.historial?.length">
      <h4><i class="bi bi-clock-history"></i> Historial</h4>
      <ul>
        <li *ngFor="let h of reporte.historial">
          {{ h.mensaje }} - <small>{{ h.fecha | date:'short' }}</small>
          (<em>{{ h.estado }}</em>)
        </li>
      </ul>
    </div>

    <div class="seccion enviar-mensaje">
      <button class="btn-enviar-mensaje" (click)="abrirEnvioMensaje()">âœ‰ï¸ Enviar Mensaje</button>
    </div>

    <app-enviar-mensaje 
      *ngIf="mostrarEnvioMensaje"
      [reporte]="reporte"
      (cerrar)="cerrarEnvioMensaje()"
      (mensajeEnviado)="agregarMensajeAlHistorial($event)">
    </app-enviar-mensaje>

    <div class="modal-footer">
      <button class="btn-avanzar" (click)="avanzarProgreso()">Avanzar Progreso</button>
      <button class="btn-cerrar" (click)="cerrarModal()">Cerrar</button>
    </div>

  </div>
</div>
