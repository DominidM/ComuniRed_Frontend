<div class="dashboard-root">
  <header class="dashboard-header">
    <div>
      <h1>Dashboard General</h1>
      <p class="subtitle">Resumen de las estadísticas del sistema</p>
    </div>
  </header>

  <!-- Top metrics -->
  <section class="metrics-grid">
    <div class="card metric-card">
      <div class="metric-icon" aria-hidden="true">
        <!-- chat icon -->
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" role="img" focusable="false">
          <path d="M21 15a2 2 0 0 1-2 2H8l-5 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="metric-body">
        <div class="metric-label">Total de Quejas</div>
        <div class="metric-value">{{ metrics.totalComplaints }}</div>
      </div>
      <div class="metric-trend">+12%</div>
    </div>

    <div class="card metric-card">
      <div class="metric-icon" aria-hidden="true">
        <!-- users icon -->
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" role="img" focusable="false">
          <path d="M17 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
          <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="metric-body">
        <div class="metric-label">Usuarios Activos</div>
        <div class="metric-value">{{ metrics.activeUsers }}</div>
      </div>
      <div class="metric-trend">+8%</div>
    </div>

    <div class="card metric-card">
      <div class="metric-icon" aria-hidden="true">
        <!-- assignment icon -->
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" role="img" focusable="false">
          <path d="M21 12v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h11" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M7 7h10v4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="metric-body">
        <div class="metric-label">Asignaciones</div>
        <div class="metric-value">{{ metrics.assignments }}</div>
      </div>
      <div class="metric-trend">+5%</div>
    </div>

    <div class="card metric-card">
      <div class="metric-icon" aria-hidden="true">
        <!-- chart icon -->
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" role="img" focusable="false">
          <path d="M3 3v18h18" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M7 13l3-3 4 4 5-7" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="metric-body">
        <div class="metric-label">Tasa de Resolución</div>
        <div class="metric-value">{{ metrics.resolutionRate }}%</div>
      </div>
      <div class="metric-trend">+15%</div>
    </div>
  </section>

  <!-- Mid panels: Estado de Quejas & Categorías más reportadas -->
  <section class="panels-grid">
    <div class="card large-card">
      <h3>Estado de Quejas</h3>
      <p class="muted">Distribución actual de quejas</p>
      <div class="bars">
        <div *ngFor="let s of statusBars" class="bar-row">
          <div class="bar-meta">
            <div style="display:flex;align-items:center;gap:8px;">
              <span class="dot" [style.background]="s.color"></span>
              <span class="bar-label">{{ s.label }}</span>
            </div>
            <span class="bar-count">{{ s.count }}</span>
          </div>
          <div class="bar-track">
            <div class="bar-fill" [style.width.%]="(s.count / statusTotal) * 100" [style.background]="s.color"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="card large-card">
      <h3>Categorías Más Reportadas</h3>
      <p class="muted">Top 5 categorías con más quejas</p>
      <div class="bars">
        <div *ngFor="let c of topCategories" class="bar-row">
          <div class="bar-meta">
            <div style="display:flex;align-items:center;gap:8px;">
              <span class="dot" [style.background]="c.color"></span>
              <span class="bar-label">{{ c.label }}</span>
            </div>
            <span class="bar-count">{{ c.count }}</span>
          </div>
          <div class="bar-track">
            <div class="bar-fill" [style.width.%]="(c.count / maxCategoryCount) * 100" [style.background]="c.color"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Bottom: Gráficos -->
  <section class="graphs-grid">
    <!-- Pie -->
    <div class="card graph-card">
      <h3>Barrios con más incidentes</h3>
      <div class="pie-wrapper">
        <div class="pie-svg-wrap">
          <svg [attr.viewBox]="'0 0 '+pieViewBox+' '+pieViewBox" class="pie-svg" role="img" aria-label="Gráfico circular de barrios">
            <g [attr.transform]="'translate('+pieCenter+','+pieCenter+') rotate(-90)'" >
              <ng-container *ngFor="let seg of pieSegments">
                <circle
                  [attr.r]="pieRadius"
                  fill="none"
                  [attr.stroke]="seg.color"
                  [attr.stroke-width]="pieStroke"
                  [attr.stroke-dasharray]="seg.dash + ' ' + (pieCircumference - seg.dash)"
                  [attr.stroke-dashoffset]="seg.offset"
                ></circle>
              </ng-container>
            </g>
          </svg>

          <div class="pie-center">
            <div class="pie-total">{{ pieTotal }}</div>
            <div class="pie-label">Total</div>
          </div>
        </div>

        <div class="pie-legend">
          <div class="legend-item" *ngFor="let seg of pieSegments">
            <div class="legend-color" [style.background]="seg.color"></div>
            <div class="legend-text">{{ seg.label }} ({{ seg.percent }}%)</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Area -->
    <div class="card graph-card">
      <h3>Estado de los reportes</h3>
      <div class="area-wrapper">
        <svg class="area-svg" viewBox="0 0 400 200" preserveAspectRatio="none" role="img" aria-label="Gráfico de área estado de reportes">
          <defs>
            <linearGradient id="gResolved" x1="0" x2="0" y1="0" y2="1">
              <stop offset="0" stop-color="#059669" stop-opacity="0.6"/>
              <stop offset="1" stop-color="#059669" stop-opacity="0.08"/>
            </linearGradient>
            <linearGradient id="gPending" x1="0" x2="0" y1="0" y2="1">
              <stop offset="0" stop-color="#dc2626" stop-opacity="0.6"/>
              <stop offset="1" stop-color="#dc2626" stop-opacity="0.08"/>
            </linearGradient>
          </defs>

          <path [attr.d]="areaResolvedPath" fill="url(#gResolved)"></path>
          <path [attr.d]="areaPendingPath" fill="url(#gPending)"></path>

          <path [attr.d]="areaResolvedLine" stroke="#059669" stroke-width="2" fill="none"></path>
          <path [attr.d]="areaPendingLine" stroke="#dc2626" stroke-width="2" fill="none"></path>
        </svg>

        <div class="area-legend">
          <div class="legend-item"><span class="legend-color" style="background:#059669"></span><span>Resueltos</span></div>
          <div class="legend-item"><span class="legend-color" style="background:#dc2626"></span><span>Pendientes</span></div>
        </div>

        <div class="area-xlabels">
          <span *ngFor="let lab of months">{{ lab }}</span>
        </div>
      </div>
    </div>
  </section>
</div>