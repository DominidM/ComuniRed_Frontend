<div class="admin-root">
  <!-- Sidebar -->
  <aside class="admin-sidebar">
    <div class="admin-logo">ComuniRed</div>

    <ul>
      <li [routerLink]="['/admin/dashboard']" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">Inicio</li>
      <li [routerLink]="['/admin/reporte-export']" routerLinkActive="active">Exportar / Generar PDFs</li>


      <!-- Auditor√≠a y configuraci√≥n (admin-only) -->
      <li *ngIf="isAdmin" [routerLink]="['/admin/auditoria']" routerLinkActive="active">Auditor√≠a / Logs</li>
      <li *ngIf="isAdmin" [routerLink]="['/admin/configuracion']" routerLinkActive="active">Configuraci√≥n del Sistema</li>

      <!-- Soporte (visible si es soporte) -->
      <li *ngIf="isSoporte">
        <a [routerLink]="['/soporte/home']" routerLinkActive="active">Bandeja Soporte</a>
      </li>



      
      <!-- Gesti√≥n DB: visible solo para admins -->
      <li *ngIf="isAdmin" class="menu-group" [class.open]="gestionOpen">
        <button class="group-btn" (click)="toggleGestion()" [attr.aria-expanded]="gestionOpen">
          Gesti√≥n DB
          <span class="chev" [class.rotated]="gestionOpen">‚ñæ</span>
        </button>

        <ul class="group-list" [attr.aria-hidden]="!gestionOpen">
          <li [routerLink]="['/admin/rol']" routerLinkActive="active">Gesti√≥n Roles</li>
          <li [routerLink]="['/admin/usuario']" routerLinkActive="active">Gesti√≥n Usuarios</li>
          <li [routerLink]="['/admin/categoria']" routerLinkActive="active">Gesti√≥n Categor√≠as</li>
          <li [routerLink]="['/admin/estado-queja']" routerLinkActive="active">Gesti√≥n Estados Queja</li>
          <li [routerLink]="['/admin/queja']" routerLinkActive="active">Gesti√≥n Quejas</li>
          <li [routerLink]="['/admin/asignacion']" routerLinkActive="active">Gesti√≥n Asignaciones</li>
          <li [routerLink]="['/admin/tipo-reaccion']" routerLinkActive="active">Gesti√≥n Tipos Reacci√≥n</li>
          <li [routerLink]="['/admin/reaccion']" routerLinkActive="active">Gesti√≥n Reacciones</li>
        </ul>
      </li>

      <!-- Herramientas (admin-only) -->
      <li *ngIf="isAdmin" class="menu-group" [class.open]="toolsOpen">
        <button class="group-btn" (click)="toggleTools()" [attr.aria-expanded]="toolsOpen">
          Herramientas
          <span class="chev" [class.rotated]="toolsOpen">‚ñæ</span>
        </button>
        <ul class="group-list" [attr.aria-hidden]="!toolsOpen">
          <li [routerLink]="['/admin/seed']" routerLinkActive="active">Correr seeds / Poblado</li>
          <li [routerLink]="['/admin/backups']" routerLinkActive="active">Backups / Restore</li>
          <li [routerLink]="['/admin/job-monitor']" routerLinkActive="active">Monitor de Jobs / Tareas</li>
          <li [routerLink]="['/admin/exports']" routerLinkActive="active">Historial de Exportes</li>
        </ul>
      </li>

      
      <!-- Public / quick links -->
      <li *ngIf="isAdmin || isSoporte">
        <a [routerLink]="['/public/home']" routerLinkActive="active">Ver sitio p√∫blico</a>
      </li>
    </ul>
  </aside>

  <!-- Main Content -->
  <div class="admin-main">
    <header class="admin-navbar">
      <input class="admin-search" type="text" placeholder="Buscar en todo el sistema..." />
      <div class="admin-user-info">
        <span>{{ userDisplay }}</span>
        <button class="admin-logout" (click)="logout()">Cerrar Sesi√≥n</button>
      </div>
    </header>
    <main>
      <router-outlet></router-outlet>
    </main>
  </div>

  <!-- Chatbot -->
  <div class="chatbot-container">
    <button class="chatbot-toggle" (click)="toggleChatbot()">
      {{ chatbotOpen ? '√ó' : 'üí¨' }}
    </button>
    <div class="chatbot-window" [class.open]="chatbotOpen">
      <div class="chatbot-header">
        <span>Asistente ComuniRed</span>
        <button class="chatbot-close" (click)="closeChatbot()">√ó</button>
      </div>
      <div class="chatbot-messages" #chatMessagesDiv>
        <div class="chat-message bot">
          <div class="message-avatar">ü§ñ</div>
          <div class="message-content">
            ¬°Hola! Soy tu asistente virtual. ¬øEn qu√© puedo ayudarte hoy?
          </div>
        </div>
        <div *ngFor="let message of chatMessages" class="chat-message" [class.user]="message.isUser" [class.bot]="!message.isUser">
          <div class="message-avatar">{{ message.isUser ? 'üë§' : 'ü§ñ' }}</div>
          <div class="message-content">{{ message.content }}</div>
        </div>
      </div>
      <div class="chatbot-input-area">
        <input 
          class="chatbot-input" 
          type="text" 
          placeholder="Escribe tu mensaje..."
          [(ngModel)]="chatMessage"
          (keyup.enter)="sendMessage()"
          #chatInput
        />
        <button class="chatbot-send" (click)="sendMessage()">‚û§</button>
      </div>
    </div>
  </div>
</div>