<div class="admin-content">
  <div class="comentarios-header">
    <div>
      <h1 class="comentarios-titulo">Gesti√≥n de Comentarios</h1>
      <p class="comentarios-subtitulo">Administra los comentarios de los usuarios sobre problemas en la comunidad</p>
    </div>
    <button class="btn-nuevo-comentario" (click)="abrirFormulario()">
      <span>‚ûï</span> Nuevo Comentario
    </button>
  </div>

  <!-- Filtros y B√∫squeda -->
  <div class="comentarios-filtros">
    <input
      type="text"
      class="comentarios-busqueda"
      placeholder="Buscar por usuario o t√≠tulo..."
      [(ngModel)]="busqueda"
    />

    <div class="filtros-grupo">
      <select class="filtro-select" [(ngModel)]="filtroEstado">
        <option>Todos</option>
        <option *ngFor="let estado of estados">{{ estado }}</option>
      </select>

      <select class="filtro-select" [(ngModel)]="filtroCategoria">
        <option>Todos</option>
        <option *ngFor="let categoria of categorias">{{ categoria }}</option>
      </select>
    </div>
  </div>

  <!-- Indicador de carga -->
  <div *ngIf="cargando" class="comentarios-cargando">
    <p>‚è≥ Cargando comentarios...</p>
  </div>

  <!-- Lista de Comentarios -->
  <div class="comentarios-lista" *ngIf="!cargando">
    <div *ngIf="comentariosFiltrados.length === 0" class="comentarios-vacio">
      <p>No hay comentarios que coincidan con los filtros</p>
    </div>

    <div *ngFor="let comentario of comentariosFiltrados" class="comentario-card">
      <div class="comentario-header">
        <div class="comentario-usuario">
          <span class="comentario-avatar">
            {{ comentario.author.foto_perfil || 'üë§' }}
          </span>
          <div>
            <h3 class="comentario-nombre">
              {{ comentario.author.nombre }} {{ comentario.author.apellido }}
            </h3>
            <span class="comentario-fecha">
              {{ comentario.fecha_creacion | date:'short' }}
            </span>
          </div>
        </div>
        <div class="comentario-acciones">
          <span [class]="'estado-badge estado-' + (comentario.estadoQueja || 'pendiente').toLowerCase().replace(' ', '-')">
            {{ comentario.estadoQueja || 'Pendiente' }}
          </span>
          <button class="btn-accion" (click)="verDetalles(comentario)">üëÅÔ∏è Ver</button>
          <button class="btn-accion" (click)="editarComentario(comentario)">‚úèÔ∏è Editar</button>
          <button class="btn-accion btn-eliminar" (click)="eliminarComentario(comentario.id)">üóëÔ∏è</button>
        </div>
      </div>

      <div class="comentario-contenido">
        <h4 class="comentario-titulo-contenido">{{ comentario.tituloQueja || 'Sin t√≠tulo' }}</h4>
        <p class="comentario-descripcion">{{ comentario.texto }}</p>
      </div>

      <div class="comentario-footer">
        <span class="comentario-categoria">{{ comentario.categoriaQueja || 'Sin categor√≠a' }}</span>
        <span class="comentario-likes">‚ù§Ô∏è {{ comentario.likes || 0 }}</span>
      </div>
    </div>
  </div>

  <!-- Modal Formulario -->
  <div *ngIf="mostrarFormulario" class="modal-overlay" (click)="cerrarFormulario()">
    <div class="modal-contenido" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Nuevo Comentario</h2>
        <button class="btn-cerrar" (click)="cerrarFormulario()">‚úï</button>
      </div>

      <div class="modal-body">
        <div class="form-group">
          <label>ID de la Queja/Reporte *</label>
          <input
            type="text"
            class="form-input"
            [(ngModel)]="formularioComentario.quejaId"
            placeholder="Ingresa el ID del reporte"
          />
          <small>Nota: Debes conocer el ID del reporte al que deseas comentar</small>
        </div>

        <div class="form-group">
          <label>Comentario *</label>
          <textarea
            class="form-textarea"
            [(ngModel)]="formularioComentario.texto"
            placeholder="Escribe tu comentario aqu√≠..."
            rows="4"
          ></textarea>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-cancelar" (click)="cerrarFormulario()">Cancelar</button>
        <button class="btn-guardar" (click)="guardarComentario()">Guardar</button>
      </div>
    </div>
  </div>

  <!-- Modal Detalles -->
  <div *ngIf="mostrarDetalles && comentarioSeleccionado" class="modal-overlay" (click)="cerrarDetalles()">
    <div class="modal-contenido modal-detalles" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Detalles del Comentario</h2>
        <button class="btn-cerrar" (click)="cerrarDetalles()">‚úï</button>
      </div>

      <div class="modal-body">
        <div class="detalles-usuario">
          <span class="detalles-avatar">
            {{ comentarioSeleccionado.author.foto_perfil || 'üë§' }}
          </span>
          <div>
            <h3>
              {{ comentarioSeleccionado.author.nombre }} 
              {{ comentarioSeleccionado.author.apellido }}
            </h3>
            <p>{{ comentarioSeleccionado.fecha_creacion | date:'full' }}</p>
            <p *ngIf="comentarioSeleccionado.fecha_modificacion" class="texto-modificado">
              Modificado: {{ comentarioSeleccionado.fecha_modificacion | date:'short' }}
            </p>
          </div>
        </div>

        <div class="detalles-seccion">
          <h4>Reporte relacionado</h4>
          <p>{{ comentarioSeleccionado.tituloQueja || 'Sin t√≠tulo' }}</p>
        </div>

        <div class="detalles-seccion">
          <h4>Comentario</h4>
          <p>{{ comentarioSeleccionado.texto }}</p>
        </div>

        <div class="detalles-grid">
          <div>
            <strong>Categor√≠a:</strong>
            <p>{{ comentarioSeleccionado.categoriaQueja || 'Sin categor√≠a' }}</p>
          </div>
          <div>
            <strong>Estado del reporte:</strong>
            <p>{{ comentarioSeleccionado.estadoQueja || 'Pendiente' }}</p>
          </div>
          <div>
            <strong>Likes:</strong>
            <p>{{ comentarioSeleccionado.likes || 0 }}</p>
          </div>
          <div>
            <strong>ID Comentario:</strong>
            <p>{{ comentarioSeleccionado.id }}</p>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-cancelar" (click)="cerrarDetalles()">Cerrar</button>
        <button class="btn-accion" (click)="editarComentario(comentarioSeleccionado); cerrarDetalles()">‚úèÔ∏è Editar</button>
        <button class="btn-eliminar-modal" (click)="eliminarComentario(comentarioSeleccionado.id)">Eliminar</button>
      </div>
    </div>
  </div>
</div>