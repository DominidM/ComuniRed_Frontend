<div class="crud-rol-root">
  <div class="crud-rol-card">
    <div class="crud-rol-header">
      <h2>Gestión de Categorías</h2>
      <button class="btn-primary" (click)="openAddModal()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        Nueva Categoría
      </button>
    </div>

    <!-- Controles superiores: Buscador + selector por página -->
    <div class="crud-rol-controls-row">
      <div class="crud-rol-search-box">
        <input type="text" [(ngModel)]="nombreBuscado" placeholder="Buscar por nombre..." (keyup.enter)="buscarCategoria()" />
        <!-- BOTÓN DE BÚSQUEDA CON ICONO LUPA -->
        <button class="crud-rol-search-btn" (click)="buscarCategoria()" aria-label="Buscar categoría">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
          </svg>
        </button>
      </div>
      <div class="crud-rol-show-select">
        <label for="pageSize">por página</label>
        <select id="pageSize" (change)="onPageSizeChange($event)" [value]="pageSize">
          <option *ngFor="let size of pageSizes" [value]="size">{{ size }}</option>
        </select>
        <span>Total: {{ totalCategorias }}</span>
      </div>
    </div>

    <div *ngIf="categorias && categorias.length > 0; else noCategorias">
      <table class="crud-rol-table">
        <thead>
          <tr>
            <th style="display: none;">ID</th>
            <th>Nombre</th>
            <th>Descripción</th>
            <th>Activo</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let cat of categorias; trackBy: trackByCategoriaId">
            <td style="display: none;">{{ cat.id }}</td>
            <td>
              <div class="role-name">{{ cat.nombre }}</div>
            </td>
            <td>
              <div class="role-description">{{ cat.descripcion }}</div>
            </td>
            <td>
              <span class="status-badge" [class.status-active]="cat.activo" [class.status-inactive]="!cat.activo">
                {{ cat.activo ? 'Sí' : 'No' }}
              </span>
            </td>
            <td>
              <div class="action-buttons">
                <button class="btn-edit" (click)="editarCategoria(cat)" title="Editar categoría">
                  Editar
                </button>
                <button class="btn-delete" (click)="eliminarCategoria(cat.id)" title="Eliminar categoría">
                  Eliminar
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <ng-template #noCategorias>
      <div class="crud-rol-empty">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" style="margin-bottom: 1rem; color: #000000;">
          <rect x="3" y="3" width="7" height="7"></rect>
          <rect x="14" y="3" width="7" height="7"></rect>
          <rect x="14" y="14" width="7" height="7"></rect>
          <rect x="3" y="14" width="7" height="7"></rect>
        </svg>
        <p>No hay categorías registradas</p>
        <button class="btn-primary" (click)="openAddModal()" style="margin-top: 1rem;">
          Crear primera categoría
        </button>
      </div>
    </ng-template>

    <!-- Modal Formulario -->
    <div class="crud-rol-modal" *ngIf="showModal" (click)="closeModal()">
      <div class="crud-rol-modal-content" (click)="$event.stopPropagation()">
        <h3>
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="7" height="7"></rect>
            <rect x="14" y="3" width="7" height="7"></rect>
            <rect x="14" y="14" width="7" height="7"></rect>
            <rect x="3" y="14" width="7" height="7"></rect>
          </svg>
          {{ editingCategoria ? 'Editar Categoría' : 'Nueva Categoría' }}
        </h3>
        
        <form (ngSubmit)="guardarCategoria()" #categoriaForm="ngForm">
          <div class="form-group">
            <label for="nombre">Nombre de la Categoría</label>
            <input 
              id="nombre" 
              name="nombre" 
              type="text"
              [(ngModel)]="nombre" 
              required 
              placeholder="Ej: Electrónica, Ropa, Alimentos..."
              autocomplete="off"
            />
          </div>
          
          <div class="form-group">
            <label for="descripcion">Descripción</label>
            <input 
              id="descripcion" 
              name="descripcion" 
              type="text"
              [(ngModel)]="descripcion" 
              placeholder="Describe las características de esta categoría..."
              autocomplete="off"
            />
          </div>
          
          <div class="form-group">
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                name="activo" 
                [(ngModel)]="activo"
                class="checkbox-input"
              />
              <span class="checkbox-text">Categoría activa</span>
            </label>
          </div>
          
          <div class="crud-rol-modal-actions">
            <button type="button" class="btn-cancel" (click)="closeModal()">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
              Cancelar
            </button>
            <button type="submit" class="btn-primary" [disabled]="!categoriaForm.valid">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20,6 9,17 4,12"></polyline>
              </svg>
              {{ editingCategoria ? 'Actualizar' : 'Guardar' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>