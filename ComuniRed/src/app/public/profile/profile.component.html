<div class="settings-container">
  <!-- ========== PROFILE HEADER ========== -->
  <div class="profile-header">
    <div class="header-background">
      <div class="header-meta">
        <span class="header-date">
          Miembro desde el {{ user?.fecha_registro | date: 'd' }} de 
          {{ user?.fecha_registro | date: 'MMMM' }} de 
          {{ user?.fecha_registro | date: 'yyyy' }}
        </span>
        <span class="header-role">Usuario</span>
      </div>
    </div>
    
    <div class="profile-info">
      <div class="avatar">
        <img [src]="user?.foto_perfil" alt="Foto de perfil" class="avatar-img" />
      </div>
    
      <div class="profile-content">
        <div class="user-info-section">
          <h1 class="user-name">{{ user?.nombre }} {{ user?.apellido }}</h1>
          <p class="user-email">{{ user?.email }}</p>
        </div>
        
        <div class="stats-row">
          <button class="stat-item stat-clickable" (click)="verSeguidores()">
            <span class="stat-number">{{ seguidoresCount }}</span>
            <span class="stat-label">seguidores</span>
          </button>
          
          <div class="stat-divider"></div>
          
          <button class="stat-item stat-clickable" (click)="verSeguidos()">
            <span class="stat-number">{{ seguidosCount }}</span>
            <span class="stat-label">seguidos</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="stats-container">
    <div class="stat-card">
      <div class="stat-number">{{ cantidadQuejas }}</div>
      <div class="stat-label">Reportes</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">0</div>
      <div class="stat-label">Resueltos</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">{{ cantidadComentarios }}</div>
      <div class="stat-label">Comentarios</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">{{ cantidadReacciones }}</div>
      <div class="stat-label">Reacciones</div>
    </div>
  </div>

  <!-- ========== TABS SECTION ========== -->
  <div class="tabs-section">
    <div class="tabs-header">
      <button 
        class="tab-btn" 
        [class.active]="currentTab === 'actividad'"
        (click)="changeTab('actividad')">
        Actividad
      </button>
      <button 
        class="tab-btn" 
        [class.active]="currentTab === 'logros'"
        (click)="changeTab('logros')">
        Logros
      </button>
      <button 
        class="tab-btn" 
        [class.active]="currentTab === 'estadisticas'"
        (click)="changeTab('estadisticas')">
        EstadÃ­sticas
      </button>
    </div>

    <div class="tab-content">
      <!-- ========== TAB ACTIVIDAD ========== -->
      <div *ngIf="currentTab === 'actividad'" class="activity-content">
        <!-- Loading -->
        <div *ngIf="loadingActividad" class="loading-state">
          <div class="spinner"></div>
          <p>Cargando actividad...</p>
        </div>

        <!-- Contenido -->
        <div *ngIf="!loadingActividad" class="activity-grid">
          <!-- Mis Reportes -->
          <div class="activity-section">
            <div class="activity-section-header">
              <h3>ğŸ“‹ Mis Reportes</h3>
              <span class="activity-count">{{ cantidadQuejas }}</span>
            </div>

            <div *ngIf="misQuejas.length === 0" class="empty-activity">
              <p>No has creado reportes aÃºn</p>
            </div>

            <div *ngIf="misQuejas.length > 0" class="activity-list">
              <div 
                *ngFor="let queja of misQuejas" 
                class="activity-item"
                (click)="verQueja(queja)">
                <div class="activity-icon">ğŸ“Œ</div>
                <div class="activity-info">
                  <h4>{{ queja.titulo }}</h4>
                  <p>{{ queja.descripcion?.slice(0, 80) }}{{ queja.descripcion?.length > 80 ? '...' : '' }}</p>
                  <div class="activity-meta">
                    <span class="activity-date">{{ queja.fecha_creacion | date:'dd/MM/yyyy' }}</span>
                    <span class="activity-category" *ngIf="queja.categoria">{{ queja.categoria.nombre }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Reportes Comentados -->
          <div class="activity-section">
            <div class="activity-section-header">
              <h3>ğŸ’¬ Reportes Comentados</h3>
              <span class="activity-count">{{ cantidadComentarios }}</span>
            </div>

            <div *ngIf="quejasComentadas.length === 0" class="empty-activity">
              <p>No has comentado en reportes aÃºn</p>
            </div>

            <div *ngIf="quejasComentadas.length > 0" class="activity-list">
              <div 
                *ngFor="let queja of quejasComentadas" 
                class="activity-item"
                (click)="verQueja(queja)">
                <div class="activity-icon">ğŸ’¬</div>
                <div class="activity-info">
                  <h4>{{ queja.titulo }}</h4>
                  <p>{{ queja.descripcion?.slice(0, 80) }}{{ queja.descripcion?.length > 80 ? '...' : '' }}</p>
                  <div class="activity-meta">
                    <span class="activity-date">{{ queja.fecha_creacion | date:'dd/MM/yyyy' }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ========== TAB LOGROS ========== -->
      <div *ngIf="currentTab === 'logros'" class="logros-content">
        <div class="logros-grid">
          <div class="logro-card" [class.unlocked]="true">
            <div class="logro-icon" style="background: linear-gradient(135deg, #ff6b6b 0%, #ff8787 100%);">ğŸ¯</div>
            <div class="logro-info">
              <h3>Primer Reporte</h3>
              <p>Creaste tu primer reporte</p>
            </div>
            <div class="logro-badge">âœ“</div>
          </div>

          <div class="logro-card" [class.unlocked]="true">
            <div class="logro-icon" style="background: linear-gradient(135deg, #ffd93d 0%, #ffed4e 100%);">â­</div>
            <div class="logro-info">
              <h3>Ciudadano Activo</h3>
              <p>Creaste 5 reportes</p>
            </div>
            <div class="logro-badge">âœ“</div>
          </div>

          <div class="logro-card" [class.unlocked]="true">
            <div class="logro-icon" style="background: linear-gradient(135deg, #ff9f43 0%, #ffb366 100%);">ğŸ†</div>
            <div class="logro-info">
              <h3>Influencer CÃ­vico</h3>
              <p>Obtuviste 100 reacciones</p>
            </div>
            <div class="logro-badge">âœ“</div>
          </div>

          <div class="logro-card" [class.unlocked]="false">
            <div class="logro-icon" style="background: linear-gradient(135deg, #d0d0d0 0%, #e0e0e0 100%);">ğŸ“‹</div>
            <div class="logro-info">
              <h3>Problema Resuelto</h3>
              <p>Un reporte tuyo fue resuelto</p>
            </div>
            <div class="logro-badge">ğŸ”’</div>
          </div>
        </div>
      </div>

      <!-- ========== TAB ESTADÃSTICAS ========== -->
      <div *ngIf="currentTab === 'estadisticas'" class="estadisticas-content">
        <div class="estadisticas-grid">
          <div class="estadistica-section">
            <h3>Impacto de tus Reportes</h3>
            <div class="estadistica-items">

              <div class="estadistica-item">
                <span class="estadistica-label">Total de reacciones</span>
                <span class="estadistica-value">{{ cantidadReacciones }}</span>
              </div>
              <div class="estadistica-item">
                <span class="estadistica-label">Total de comentarios</span>
                <span class="estadistica-value">{{ cantidadComentarios }}</span>
              </div>
              <div class="estadistica-item">
                <span class="estadistica-label">Tasa de resoluciÃ³n</span>
                <span class="estadistica-value" style="color: #10b981;">0%</span>
              </div>
            </div>
          </div>

          <div class="estadistica-section">
            <h3>ParticipaciÃ³n</h3>
            <div class="estadistica-items">
              <div class="estadistica-item">
                <span class="estadistica-label">Reportes totales</span>
                <span class="estadistica-value">{{ cantidadQuejas }}</span>
              </div>
              <div class="estadistica-item">
                <span class="estadistica-label">Comentarios totales</span>
                <span class="estadistica-value">{{ cantidadComentarios }}</span>
              </div>
              <div class="estadistica-item">
                <span class="estadistica-label">Racha actual</span>
                <span class="estadistica-value" style="color: #f97316;">0 dÃ­as</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== MODAL SEGUIDORES ========== -->
  <div class="modal-overlay" *ngIf="mostrarModalSeguidores" (click)="cerrarModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Seguidores ({{ seguidoresCount }})</h2>
        <button class="modal-close" (click)="cerrarModal()">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>

      <div class="modal-body">
        <div *ngIf="loadingModal" class="modal-loading">
          <p>â³ Cargando...</p>
        </div>

        <div *ngIf="!loadingModal && listaSeguidores.length === 0" class="modal-empty">
          <p>No tienes seguidores aÃºn</p>
        </div>

        <div *ngIf="!loadingModal && listaSeguidores.length > 0" class="users-list">
          <div *ngFor="let usuario of listaSeguidores" class="user-item">
            <img 
              [src]="obtenerFoto(usuario.foto_perfil)" 
              [alt]="usuario.nombre"
              class="user-avatar-small"
              (click)="verPerfil(usuario)"
            />
            
            <div class="user-info-modal">
              <h4>{{ usuario.nombre }} {{ usuario.apellido }}</h4>
              <p *ngIf="usuario.distrito">ğŸ“ {{ usuario.distrito }}</p>
            </div>

            <button class="btn-view-modal" (click)="verPerfil(usuario)">
              <i class="bi bi-eye"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== MODAL SEGUIDOS ========== -->
  <div class="modal-overlay" *ngIf="mostrarModalSeguidos" (click)="cerrarModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Siguiendo ({{ seguidosCount }})</h2>
        <button class="modal-close" (click)="cerrarModal()">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>

      <div class="modal-body">
        <div *ngIf="loadingModal" class="modal-loading">
          <p>â³ Cargando...</p>
        </div>

        <div *ngIf="!loadingModal && listaSeguidos.length === 0" class="modal-empty">
          <p>No sigues a nadie aÃºn</p>
        </div>

        <div *ngIf="!loadingModal && listaSeguidos.length > 0" class="users-list">
          <div *ngFor="let usuario of listaSeguidos" class="user-item">
            <img 
              [src]="obtenerFoto(usuario.foto_perfil)" 
              [alt]="usuario.nombre"
              class="user-avatar-small"
              (click)="verPerfil(usuario)"
            />
            
            <div class="user-info-modal">
              <h4>{{ usuario.nombre }} {{ usuario.apellido }}</h4>
              <p *ngIf="usuario.distrito">ğŸ“ {{ usuario.distrito }}</p>
            </div>

            <button class="btn-unfollow" (click)="dejarDeSeguir(usuario)">
              Dejar de seguir
            </button>

            <button class="btn-view-modal" (click)="verPerfil(usuario)">
              <i class="bi bi-eye"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
